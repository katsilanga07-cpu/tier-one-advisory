<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Monitoring - Tier One Advisory Philippines Inc.</title>

    <!-- Tailwind CSS with Line Clamp Plugin -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/line-clamp@0.4.2/browser/index.min.js"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
      .header-gradient {
        background: linear-gradient(135deg, #0056a3 0%, #003d75 100%);
      }
      .lightbox {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1000;
      }
      .lightbox-content {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        padding: 2rem;
        border-radius: 12px;
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
      }
      .task-card {
        transition: all 0.3s ease;
      }
      .task-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
      }
      /* Sage Green Background Gradient */
      body {
        background: linear-gradient(135deg, #9dc183 0%, #7d9a68 100%);
        min-height: 100vh;
      }
      /* Random Card Background Colors with proper text contrast */
      .card-bg-1 { background-color: #3b82f6; color: white; }  /* Blue */
      .card-bg-2 { background-color: #ef4444; color: white; }  /* Red */
      .card-bg-3 { background-color: #10b981; color: white; }  /* Green */
      .card-bg-4 { background-color: #f59e0b; color: black; }  /* Yellow */
      .card-bg-5 { background-color: #8b5cf6; color: white; }  /* Purple */
      .card-bg-6 { background-color: #ec4899; color: white; }  /* Pink */
      .card-bg-7 { background-color: #06b6d4; color: white; }  /* Cyan */
      .card-bg-8 { background-color: #84cc16; color: black; }  /* Lime */
      .card-bg-9 { background-color: #f97316; color: white; }  /* Orange */
      .card-bg-10 { background-color: #6366f1; color: white; } /* Indigo */
      .card-bg-11 { background-color: #14b8a6; color: white; } /* Teal */
      .card-bg-12 { background-color: #fbbf24; color: black; } /* Amber */
    </style>
  </head>

  <body class="bg-gradient-to-br from-[#9dc183] to-[#7d9a68]">
    <!-- Header -->
    <header class="bg-white shadow-sm">
      <!-- Top Bar -->
      <div class="bg-gray-800 text-white py-2">
        <div class="container mx-auto px-4">
          <div class="flex justify-between items-center text-sm">
            <div class="flex space-x-4">
              <a href="#" class="hover:text-blue-300 transition"><i class="fas fa-globe mr-1"></i> Philippines</a>
              <a href="#" class="hover:text-blue-300 transition"><i class="fas fa-phone mr-1"></i> Contact Us</a>
              <a href="#" class="hover:text-blue-300 transition"><i class="fas fa-user mr-1"></i> Login</a>
            </div>
            <div class="flex space-x-4">
              <a href="#" class="hover:text-blue-300 transition"><i class="fab fa-linkedin"></i></a>
              <a href="#" class="hover:text-blue-300 transition"><i class="fab fa-twitter"></i></a>
              <a href="#" class="hover:text-blue-300 transition"><i class="fab fa-facebook"></i></a>
            </div>
          </div>
        </div>
      </div>

      <!-- Enhanced Main Navigation -->
      <nav class="header-gradient text-white shadow-lg">
        <div class="container mx-auto px-4">
          <div class="flex items-center justify-between py-4">
            <!-- Company Logo & Name -->
            <div class="flex items-center space-x-8">
              <a href="index.html" class="flex items-center space-x-3 text-2xl font-bold text-white">
                <div class="w-10 h-10 bg-white rounded-lg flex items-center justify-center">
                  <span class="text-blue-600 font-bold text-lg">T1</span>
                </div>
                <span>Tier One Advisory</span>
              </a>
              
              <!-- Main Menu -->
              <div class="hidden md:flex space-x-1">
                <a href="index.html" class="px-4 py-2 rounded-lg hover:bg-white/10 transition-all duration-200">Dashboard</a>
                <a href="request-form.html" class="px-4 py-2 rounded-lg hover:bg-white/10 transition-all duration-200">Request Form</a>
                <a href="search.html" class="px-4 py-2 rounded-lg hover:bg-white/10 transition-all duration-200">Search</a>
                <a href="monitoring.html" class="px-4 py-2 rounded-lg bg-white/20 font-semibold transition-all duration-200">Monitoring</a>
              </div>
            </div>

            <!-- Right Side Actions -->
            <div class="flex items-center space-x-4">
              <a href="search.html" class="p-2 hover:bg-white/10 rounded-lg transition-all duration-200">
                <i class="fas fa-search"></i>
              </a>
              <div class="relative">
                <button class="flex items-center space-x-2 p-2 hover:bg-white/10 rounded-lg transition-all duration-200">
                  <div class="w-8 h-8 bg-white/20 rounded-full flex items-center justify-center">
                    <i class="fas fa-user text-sm"></i>
                  </div>
                </button>
              </div>
            </div>
          </div>
        </div>
      </nav>

      <!-- Breadcrumb -->
      <div class="bg-gray-100 border-b">
        <div class="container mx-auto px-4 py-2">
          <nav class="text-sm">
            <ol class="list-none p-0 inline-flex">
              <li class="flex items-center">
                <a href="index.html" class="text-blue-600 hover:text-blue-800">Home</a>
                <span class="mx-2 text-gray-400">/</span>
              </li>
              <li class="flex items-center">
                <a href="index.html" class="text-blue-600 hover:text-blue-800">Dashboard</a>
                <span class="mx-2 text-gray-400">/</span>
              </li>
              <li class="text-gray-500">Monitoring</li>
            </ol>
          </nav>
        </div>
      </div>
    </header>

    <!-- Monitoring Content -->
    <main class="container mx-auto px-4 py-8">
      <!-- Page Header -->
      <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-800 mb-2">Request Monitoring</h1>
        <p class="text-gray-600">Track and update request status in real-time</p>
      </div>

      <!-- Stats Overview -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
        <div class="bg-white rounded-xl shadow-md p-6 border-l-4 border-red-500">
          <div class="flex items-center">
            <div class="p-3 bg-red-100 rounded-lg">
              <i class="fas fa-clock text-red-600 text-xl"></i>
            </div>
            <div class="ml-4">
              <p class="text-sm text-gray-600">Pending</p>
              <h3 class="text-2xl font-bold text-gray-800" id="pendingCount">0</h3>
            </div>
          </div>
        </div>

        <div class="bg-white rounded-xl shadow-md p-6 border-l-4 border-yellow-500">
          <div class="flex items-center">
            <div class="p-3 bg-yellow-100 rounded-lg">
              <i class="fas fa-spinner text-yellow-600 text-xl"></i>
            </div>
            <div class="ml-4">
              <p class="text-sm text-gray-600">In Progress</p>
              <h3 class="text-2xl font-bold text-gray-800" id="inProgressCount">0</h3>
            </div>
          </div>
        </div>

        <div class="bg-white rounded-xl shadow-md p-6 border-l-4 border-green-500">
          <div class="flex items-center">
            <div class="p-3 bg-green-100 rounded-lg">
              <i class="fas fa-check-circle text-green-600 text-xl"></i>
            </div>
            <div class="ml-4">
              <p class="text-sm text-gray-600">Completed</p>
              <h3 class="text-2xl font-bold text-gray-800" id="completedCount">0</h3>
            </div>
          </div>
        </div>
      </div>

      <!-- Tasks Container -->
      <div class="bg-white rounded-xl shadow-md overflow-hidden">
        <div class="px-6 py-4 border-b border-gray-200 flex justify-between items-center">
          <h2 class="text-xl font-semibold text-gray-800">All Requests</h2>
          <div class="flex items-center space-x-4">
            <span class="text-sm text-gray-600" id="paginationInfo">Showing 0-0 of 0</span>
            <div class="flex space-x-2">
              <button id="prevPage" class="px-3 py-1 border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed">
                <i class="fas fa-chevron-left"></i>
              </button>
              <button id="nextPage" class="px-3 py-1 border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed">
                <i class="fas fa-chevron-right"></i>
              </button>
            </div>
          </div>
        </div>
        
        <div id="tasksContainer" class="p-6 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
          <!-- Tasks will be loaded here -->
          <div class="col-span-full text-center text-gray-500 py-8">
            <i class="fas fa-spinner fa-spin text-blue-500 text-3xl mb-3"></i>
            <p>Loading requests...</p>
          </div>
        </div>

        <!-- Pagination Controls -->
        <div class="px-6 py-4 border-t border-gray-200 flex justify-between items-center">
          <span class="text-sm text-gray-600" id="pageInfo">Page 1 of 1</span>
          <div class="flex space-x-2">
            <button id="firstPage" class="px-3 py-1 border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
              <i class="fas fa-angle-double-left"></i>
            </button>
            <button id="prevPageBottom" class="px-3 py-1 border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
              <i class="fas fa-chevron-left"></i>
            </button>
            <div id="pageNumbers" class="flex space-x-1">
              <!-- Page numbers will be generated here -->
            </div>
            <button id="nextPageBottom" class="px-3 py-1 border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
              <i class="fas fa-chevron-right"></i>
            </button>
            <button id="lastPage" class="px-3 py-1 border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
              <i class="fas fa-angle-double-right"></i>
            </button>
          </div>
        </div>
      </div>
    </main>

    <!-- Status Update Lightbox -->
    <div id="statusLightbox" class="lightbox">
      <div class="lightbox-content w-full max-w-md">
        <div class="text-center">
          <i class="fas fa-sync-alt text-blue-600 text-3xl mb-4"></i>
          <h3 class="text-xl font-semibold text-gray-800 mb-2" id="lightboxTitle">Update Status</h3>
          <p class="text-gray-600 mb-6" id="lightboxMessage">Are you sure you want to update the status?</p>
          
          <div class="flex space-x-4 justify-center">
            <button id="confirmUpdate" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition">
              Yes, Update
            </button>
            <button id="cancelUpdate" class="bg-gray-500 text-white px-6 py-2 rounded-lg hover:bg-gray-600 transition">
              Cancel
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white mt-12">
      <div class="container mx-auto px-4 py-8">
        <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
          <div>
            <h3 class="font-bold text-lg mb-4">Company</h3>
            <ul class="space-y-2">
              <li><a href="#" class="hover:text-blue-300 transition">About Us</a></li>
              <li><a href="#" class="hover:text-blue-300 transition">Leadership</a></li>
              <li><a href="#" class="hover:text-blue-300 transition">Careers</a></li>
              <li><a href="#" class="hover:text-blue-300 transition">News</a></li>
            </ul>
          </div>
          <div>
            <h3 class="font-bold text-lg mb-4">Services</h3>
            <ul class="space-y-2">
              <li><a href="#" class="hover:text-blue-300 transition">All Services</a></li>
              <li><a href="#" class="hover:text-blue-300 transition">Industries</a></li>
              <li><a href="#" class="hover:text-blue-300 transition">Locations</a></li>
            </ul>
          </div>
          <div>
            <h3 class="font-bold text-lg mb-4">Support</h3>
            <ul class="space-y-2">
              <li><a href="#" class="hover:text-blue-300 transition">Contact Us</a></li>
              <li><a href="#" class="hover:text-blue-300 transition">Help Center</a></li>
              <li><a href="#" class="hover:text-blue-300 transition">Privacy Policy</a></li>
            </ul>
          </div>
          <div>
            <h3 class="font-bold text-lg mb-4">Connect</h3>
            <div class="flex space-x-4">
              <a href="#" class="hover:text-blue-300 transition"><i class="fab fa-linkedin text-xl"></i></a>
              <a href="#" class="hover:text-blue-300 transition"><i class="fab fa-twitter text-xl"></i></a>
              <a href="#" class="hover:text-blue-300 transition"><i class="fab fa-facebook text-xl"></i></a>
            </div>
          </div>
        </div>
        <div class="border-t border-gray-700 mt-8 pt-6 text-center text-sm text-gray-400">
          <p>&copy; 2024 Tier One Advisory Philippines Inc. All rights reserved.</p>
        </div>
      </div>
    </footer>

    <!-- JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
      const { createClient } = supabase;
      const SUPABASE_URL = "https://webdmcvcbfeytwhzonem.supabase.co";
      const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndlYmRtY3ZjYmZleXR3aHpvbmVtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIzMDc5ODYsImV4cCI6MjA3Nzg4Mzk4Nn0.QlZeRqYvbdqNfRKrq_MIB0VBSM4ZcyeVtD_9O9uFAI8";
      const supabaseClient = createClient(SUPABASE_URL, SUPABASE_KEY);

      let currentTaskId = null;
      let currentNewStatus = null;
      let allTasks = [];
      let currentPage = 1;
      const tasksPerPage = 12;

      // Load all tasks
      async function loadTasks() {
        try {
          const { data: tasks, error } = await supabaseClient
            .from('tasks_database')
            .select('*')
            .order('created_at', { ascending: false });

          if (error) throw error;

          allTasks = tasks;
          updateStats(tasks);
          displayPage(1);
        } catch (error) {
          console.error('Error loading tasks:', error);
          document.getElementById('tasksContainer').innerHTML = 
            '<div class="col-span-full text-center text-red-500 py-8"><i class="fas fa-exclamation-triangle text-2xl mb-3"></i><p>Error loading tasks</p></div>';
        }
      }

      // Display tasks for specific page
      function displayPage(page) {
        currentPage = page;
        const startIndex = (page - 1) * tasksPerPage;
        const endIndex = startIndex + tasksPerPage;
        const pageTasks = allTasks.slice(startIndex, endIndex);
        
        displayTasks(pageTasks);
        updatePagination();
      }

      // Display tasks as cards in grid
      function displayTasks(tasks) {
        const container = document.getElementById('tasksContainer');
        
        if (!tasks || tasks.length === 0) {
          container.innerHTML = '<div class="col-span-full text-center text-gray-500 py-8"><i class="fas fa-inbox text-3xl mb-3"></i><p>No requests found</p></div>';
          return;
        }

        let tasksHtml = '';
        tasks.forEach((task, index) => {
          const statusColor = getStatusColor(task.status);
          const randomBgClass = getRandomBackgroundClass(index);
          
          tasksHtml += `
            <div class="task-card rounded-lg p-4 shadow-sm ${randomBgClass}" data-task-id="${task.id}">
              <div class="flex justify-between items-start mb-3">
                <div class="flex-1">
                  <h3 class="text-md font-semibold truncate" title="${task.client} - ${task.subClient || 'No Sub-Client'}">${task.client} - ${task.subClient || 'No Sub-Client'}</h3>
                  <p class="text-xs opacity-80 mt-1">${new Date(task.date).toLocaleDateString()}</p>
                </div>
                <span class="px-2 py-1 rounded-full text-xs font-semibold ${statusColor} ml-2 flex-shrink-0">
                  ${task.status || 'pending'}
                </span>
              </div>
              
              <div class="space-y-2 mb-3">
                <div>
                  <p class="text-xs opacity-80">Category</p>
                  <p class="font-medium text-sm truncate">${task.category}</p>
                </div>
                <div>
                  <p class="text-xs opacity-80">Document Type</p>
                  <p class="font-medium text-sm truncate">${task.documentType}</p>
                </div>
              </div>
              
              ${task.notes ? `
                <div class="mb-3">
                  <p class="text-xs opacity-80">Notes</p>
                  <p class="text-sm line-clamp-2">${task.notes}</p>
                </div>
              ` : ''}
              
              <div class="flex justify-end">
                <button onclick="showStatusUpdate('${task.id}', '${task.status}')" 
                        class="bg-white bg-opacity-20 backdrop-blur-sm px-3 py-1 rounded-lg hover:bg-opacity-30 transition text-xs font-medium">
                  <i class="fas fa-sync-alt mr-1"></i>Update
                </button>
              </div>
            </div>
          `;
        });

        container.innerHTML = tasksHtml;
      }

      // Get random background color class with proper text contrast
      function getRandomBackgroundClass(index) {
        const colorClasses = [
          'card-bg-1', 'card-bg-2', 'card-bg-3', 'card-bg-4',
          'card-bg-5', 'card-bg-6', 'card-bg-7', 'card-bg-8',
          'card-bg-9', 'card-bg-10', 'card-bg-11', 'card-bg-12'
        ];
        return colorClasses[index % colorClasses.length];
      }

      // Get status badge color (adjusted for colored backgrounds)
      function getStatusColor(status) {
        switch(status) {
          case 'pending': return 'bg-red-500 bg-opacity-20 text-red-100';
          case 'in-progress': return 'bg-yellow-500 bg-opacity-20 text-yellow-100';
          case 'completed': return 'bg-green-500 bg-opacity-20 text-green-100';
          default: return 'bg-red-500 bg-opacity-20 text-red-100';
        }
      }

      // Update statistics
      function updateStats(tasks) {
        const pendingCount = tasks.filter(t => t.status === 'pending').length;
        const inProgressCount = tasks.filter(t => t.status === 'in-progress').length;
        const completedCount = tasks.filter(t => t.status === 'completed').length;

        document.getElementById('pendingCount').textContent = pendingCount;
        document.getElementById('inProgressCount').textContent = inProgressCount;
        document.getElementById('completedCount').textContent = completedCount;
      }

      // Update pagination controls
      function updatePagination() {
        const totalPages = Math.ceil(allTasks.length / tasksPerPage);
        const startIndex = (currentPage - 1) * tasksPerPage + 1;
        const endIndex = Math.min(currentPage * tasksPerPage, allTasks.length);
        
        // Update pagination info
        document.getElementById('paginationInfo').textContent = `Showing ${startIndex}-${endIndex} of ${allTasks.length}`;
        document.getElementById('pageInfo').textContent = `Page ${currentPage} of ${totalPages}`;
        
        // Update button states
        document.getElementById('prevPage').disabled = currentPage === 1;
        document.getElementById('nextPage').disabled = currentPage === totalPages;
        document.getElementById('prevPageBottom').disabled = currentPage === 1;
        document.getElementById('nextPageBottom').disabled = currentPage === totalPages;
        document.getElementById('firstPage').disabled = currentPage === 1;
        document.getElementById('lastPage').disabled = currentPage === totalPages;
        
        // Generate page numbers
        const pageNumbersContainer = document.getElementById('pageNumbers');
        pageNumbersContainer.innerHTML = '';
        
        const maxVisiblePages = 5;
        let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
        let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);
        
        if (endPage - startPage + 1 < maxVisiblePages) {
          startPage = Math.max(1, endPage - maxVisiblePages + 1);
        }
        
        for (let i = startPage; i <= endPage; i++) {
          const pageButton = document.createElement('button');
          pageButton.className = `px-3 py-1 border rounded-lg ${
            i === currentPage 
              ? 'bg-blue-600 text-white border-blue-600' 
              : 'border-gray-300 hover:bg-gray-50'
          }`;
          pageButton.textContent = i;
          pageButton.addEventListener('click', () => displayPage(i));
          pageNumbersContainer.appendChild(pageButton);
        }
      }

      // Pagination event listeners
      document.getElementById('prevPage').addEventListener('click', () => {
        if (currentPage > 1) displayPage(currentPage - 1);
      });

      document.getElementById('nextPage').addEventListener('click', () => {
        if (currentPage < Math.ceil(allTasks.length / tasksPerPage)) displayPage(currentPage + 1);
      });

      document.getElementById('prevPageBottom').addEventListener('click', () => {
        if (currentPage > 1) displayPage(currentPage - 1);
      });

      document.getElementById('nextPageBottom').addEventListener('click', () => {
        if (currentPage < Math.ceil(allTasks.length / tasksPerPage)) displayPage(currentPage + 1);
      });

      document.getElementById('firstPage').addEventListener('click', () => {
        displayPage(1);
      });

      document.getElementById('lastPage').addEventListener('click', () => {
        displayPage(Math.ceil(allTasks.length / tasksPerPage));
      });

      // Show status update lightbox
      function showStatusUpdate(taskId, currentStatus) {
        currentTaskId = taskId;
        
        let nextStatus, title, message;
        
        if (currentStatus === 'pending') {
          nextStatus = 'in-progress';
          title = 'Start Progress';
          message = 'Move this task from Pending to In Progress?';
        } else if (currentStatus === 'in-progress') {
          nextStatus = 'completed';
          title = 'Complete Task';
          message = 'Mark this task as Completed?';
        } else {
          return; // No further updates for completed tasks
        }
        
        currentNewStatus = nextStatus;
        
        document.getElementById('lightboxTitle').textContent = title;
        document.getElementById('lightboxMessage').textContent = message;
        document.getElementById('statusLightbox').style.display = 'block';
      }

      // Update task status
      async function updateTaskStatus() {
        if (!currentTaskId || !currentNewStatus) return;

        try {
          const { error } = await supabaseClient
            .from('tasks_database')
            .update({ 
              status: currentNewStatus,
              updated_at: new Date().toISOString()
            })
            .eq('id', currentTaskId);

          if (error) throw error;

          // Close lightbox and reload tasks
          document.getElementById('statusLightbox').style.display = 'none';
          loadTasks();
          
        } catch (error) {
          console.error('Error updating task:', error);
          alert('Error updating task status');
        }
      }

      // Event listeners
      document.getElementById('confirmUpdate').addEventListener('click', updateTaskStatus);
      document.getElementById('cancelUpdate').addEventListener('click', function() {
        document.getElementById('statusLightbox').style.display = 'none';
      });

      // Close lightbox when clicking outside
      document.getElementById('statusLightbox').addEventListener('click', function(e) {
        if (e.target === this) {
          this.style.display = 'none';
        }
      });

      // Initialize
      document.addEventListener('DOMContentLoaded', loadTasks);
    </script>
  </body>
</html>