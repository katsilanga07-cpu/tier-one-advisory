<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Request Access - Tier One Advisory</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        .hero-section {
            background-image: url('https://www.colliers.com/-/media/images/colliers/asia/philippines/colliers-review/cv_hero_image_05112022.ashx?bid=f3a4b2af29bf4b7e884b1731bb621986&w=747&hash=151C553171C66AB84567EC9BC400666F');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }
        .header-gradient {
            background: linear-gradient(135deg, #0056a3 0%, #003d75 100%);
        }
        /* Updated glass card with #222222 background and blur */
        .glass-card {
            background: rgba(34, 34, 34, 0.85); /* #222222 with transparency */
            backdrop-filter: blur(12px); /* Blur effect */
            -webkit-backdrop-filter: blur(12px); /* Safari support */
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #ffffff;
        }
        .feature-card {
            background: rgba(34, 34, 34, 0.8); /* #222222 background */
            backdrop-filter: blur(10px); /* Slightly less blur */
            -webkit-backdrop-filter: blur(10px); /* Safari support */
            border: 1px solid rgba(255, 255, 255, 0.15);
            color: #ffffff;
        }
        .text-light {
            color: #ffffff;
        }
        .text-light-secondary {
            color: rgba(255, 255, 255, 0.9);
        }
        .text-light-tertiary {
            color: rgba(255, 255, 255, 0.8);
        }
        .button-glow:hover {
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.5);
        }
        .form-input {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: #ffffff;
        }
        .form-input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }
        .form-input:focus {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(59, 130, 246, 0.8);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3);
        }
        
        /* Custom dropdown styling */
        select.form-input {
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%23ffffff'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 1rem center;
            background-size: 1.5em;
            padding-right: 3rem;
        }
        
        /* Dropdown options styling - FIXED FOR ALL BROWSERS */
        select.form-input option {
            background: #222222 !important;
            color: white !important;
            padding: 12px;
        }
        
        /* For Firefox */
        select.form-input option:checked,
        select.form-input option:hover {
            background: #3b82f6 !important;
            color: white !important;
        }
        
        /* For Webkit browsers (Chrome, Safari, Edge) */
        select.form-input:focus option:checked {
            background: #3b82f6 !important;
            color: white !important;
        }
        
        /* Style the dropdown list itself */
        select.form-input:focus {
            background: rgba(255, 255, 255, 0.15);
        }
        
        /* Additional styling for better dropdown appearance */
        select.form-input::-webkit-list-box,
        select.form-input::-webkit-scrollbar {
            background: #222222 !important;
        }
        
        select.form-input::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 4px;
        }
        
        select.form-input::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
        }
        
        /* For the dropdown list container */
        select.form-input option {
            background-color: #222222 !important;
            color: white !important;
        }
        
        /* Hover state for options */
        select.form-input option:hover {
            background-color: #3b82f6 !important;
            color: white !important;
        }
        
        /* Selected option styling */
        select.form-input option:checked {
            background-color: #3b82f6 !important;
            color: white !important;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">
    <!-- Header -->
    <header class="header-gradient text-white shadow-lg">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-white rounded-lg flex items-center justify-center">
                        <span class="text-blue-600 font-bold text-lg">T1</span>
                    </div>
                    <span class="text-xl font-bold">Tier One Advisory</span>
                </div>
                <a href="login.html" class="hover:text-blue-200 transition flex items-center bg-white/10 px-4 py-2 rounded-lg">
                    <i class="fas fa-sign-in-alt mr-2"></i>Login
                </a>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-1 hero-section">
        <div class="container mx-auto px-4 py-16">
            <div class="max-w-2xl mx-auto">
                <!-- Main Registration Card -->
                <div class="glass-card rounded-2xl shadow-2xl p-8 md:p-12 mb-8">
                    <div class="text-center mb-8">
                        <div class="w-20 h-20 bg-blue-500/20 rounded-xl flex items-center justify-center mx-auto mb-6 border border-blue-400/30">
                            <i class="fas fa-user-plus text-white text-3xl"></i>
                        </div>
                        <h1 class="text-4xl font-bold text-light mb-4">
                            Request Access
                        </h1>
                        <p class="text-xl text-light-secondary mb-2">
                            Join Tier One Advisory System
                        </p>
                        <p class="text-light-tertiary text-sm">
                            Fill out the form below to request account access
                        </p>
                    </div>
                    
                    <!-- Registration Form -->
                    <form id="registerForm" class="space-y-6">
                        <div>
                            <label class="block text-sm font-medium text-light-secondary mb-3">
                                <i class="fas fa-user mr-2"></i>Full Name
                            </label>
                            <input type="text" id="fullName" required
                                   class="form-input w-full p-4 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200"
                                   placeholder="John Smith">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-light-secondary mb-3">
                                <i class="fas fa-envelope mr-2"></i>Email Address
                            </label>
                            <input type="email" id="email" required
                                   class="form-input w-full p-4 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200"
                                   placeholder="your.email@company.com">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-light-secondary mb-3">
                                <i class="fas fa-building mr-2"></i>Department
                            </label>
                            <select id="department" required
                                    class="form-input w-full p-4 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200">
                                <option value="">Select Department</option>
                                <option value="Legal">Legal Department</option>
                                <option value="Finance">Finance</option>
                                <option value="Operations">Operations</option>
                                <option value="Compliance">Compliance</option>
                                <option value="HR">Human Resources</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-light-secondary mb-3">
                                <i class="fas fa-lock mr-2"></i>Password
                            </label>
                            <input type="password" id="password" required minlength="6"
                                   class="form-input w-full p-4 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200"
                                   placeholder="Create a password (min. 6 characters)">
                        </div>

                        <button type="submit" id="registerButton"
                                class="w-full bg-blue-600 hover:bg-blue-700 text-white p-4 rounded-xl text-lg font-semibold transition-all duration-200 flex items-center justify-center shadow-lg hover:shadow-xl transform hover:-translate-y-1 button-glow">
                            <i class="fas fa-user-plus mr-3"></i>
                            Request Access
                        </button>
                    </form>

                    <!-- Login Link -->
                    <div class="mt-6 text-center">
                        <p class="text-light-secondary">
                            Already have an account?
                            <a href="login.html" class="text-blue-300 hover:text-white font-medium underline">Sign In</a>
                        </p>
                    </div>
                </div>

                <!-- Info Cards -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                    <div class="feature-card rounded-xl p-6 text-center">
                        <div class="w-12 h-12 bg-blue-500/20 rounded-lg flex items-center justify-center mb-4 mx-auto">
                            <i class="fas fa-clock text-white text-xl"></i>
                        </div>
                        <h4 class="font-semibold text-light mb-2">Quick Approval</h4>
                        <p class="text-light-secondary text-sm">Requests typically approved within 24 hours</p>
                    </div>
                    <div class="feature-card rounded-xl p-6 text-center">
                        <div class="w-12 h-12 bg-green-500/20 rounded-lg flex items-center justify-center mb-4 mx-auto">
                            <i class="fas fa-shield-alt text-white text-xl"></i>
                        </div>
                        <h4 class="font-semibold text-light mb-2">Secure Access</h4>
                        <p class="text-light-secondary text-sm">Enterprise-grade security for your data</p>
                    </div>
                </div>

                <!-- Important Note -->
                <div class="glass-card rounded-xl p-6 max-w-2xl mx-auto border-l-4 border-yellow-400">
                    <h3 class="font-semibold text-light mb-3 flex items-center justify-center text-lg">
                        <i class="fas fa-info-circle mr-2 text-yellow-300"></i>Approval Required
                    </h3>
                    <div class="text-center">
                        <p class="text-light-secondary mb-2">
                            All access requests require administrator approval before you can use the system.
                        </p>
                        <p class="text-light-tertiary text-sm">
                            You will receive an email notification once your account is approved.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-900/90 text-white py-8">
        <div class="container mx-auto px-4">
            <div class="text-center">
                <div class="flex justify-center items-center mb-4">
                    <div class="w-8 h-8 bg-white rounded-lg flex items-center justify-center mr-3">
                        <span class="text-blue-600 font-bold">T1</span>
                    </div>
                    <span class="text-lg font-bold">Tier One Advisory Philippines Inc.</span>
                </div>
                <p class="text-gray-300 text-sm">&copy; 2024 All rights reserved. Internal Request Management System</p>
                <div class="flex justify-center space-x-4 mt-4">
                    <a href="#" class="text-gray-400 hover:text-white transition">
                        <i class="fas fa-envelope"></i>
                    </a>
                    <a href="#" class="text-gray-400 hover:text-white transition">
                        <i class="fas fa-phone"></i>
                    </a>
                    <a href="#" class="text-gray-400 hover:text-white transition">
                        <i class="fas fa-info-circle"></i>
                    </a>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // Initialize Supabase
        const SUPABASE_URL = "https://webdmcvcbfeytwhzonem.supabase.co";
        const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndlYmRtY3ZjYmZleXR3aHpvbmVtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIzMDc5ODYsImV4cCI6MjA3Nzg4Mzk4Nn0.QlZeRqYvbdqNfRKrq_MIB0VBSM4ZcyeVtD_9O9uFAI8";
        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        // Registration function - SIMPLIFIED VERSION
        document.getElementById('registerForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const fullName = document.getElementById('fullName').value;
            const email = document.getElementById('email').value;
            const department = document.getElementById('department').value;
            const password = document.getElementById('password').value;
            const button = document.getElementById('registerButton');
            
            // Show loading state
            const originalText = button.innerHTML;
            button.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Requesting Access...';
            button.disabled = true;
            
            try {
                console.log('Starting registration process...');
                
                // Sign up with Supabase Auth
                const { data: authData, error: authError } = await supabaseClient.auth.signUp({
                    email: email,
                    password: password,
                    options: {
                        data: {
                            full_name: fullName,
                            department: department
                        }
                    }
                });
                
                if (authError) {
                    console.error('Auth error:', authError);
                    throw authError;
                }
                
                console.log('Auth successful, creating profile...');
                
                if (authData.user) {
                    // Create user profile with PENDING status
                    const { error: profileError } = await supabaseClient
                        .from('user_profiles')
                        .insert({
                            id: authData.user.id,
                            email: email,
                            full_name: fullName,
                            department: department,
                            role: 'requester',
                            status: 'pending'
                        });
                    
                    if (profileError) {
                        console.error('Profile creation error:', profileError);
                        // Don't throw error - user can still proceed
                    }
                    
                    // SUCCESS - Show message and redirect to login
                    console.log('Registration successful!');
                    alert('âœ… Access request submitted! Your account is pending approval. You will receive an email when an administrator approves your access.');
                    
                    // Wait a moment then redirect to login
                    setTimeout(() => {
                        window.location.href = 'login.html';
                    }, 2000);
                }
                
            } catch (error) {
                console.error('Registration error:', error);
                alert('Registration failed: ' + error.message);
                button.innerHTML = originalText;
                button.disabled = false;
            }
        });

        // NO AUTO-REDIRECT CODE - Page stays open for registration
        console.log('Register page loaded successfully - ready for new users');

    </script>
</body>
</html>
