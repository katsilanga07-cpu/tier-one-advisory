<!DOCTYPE html>
<html lang="en">
<head>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Database Manager - Tier One Advisory</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Simple Header -->
    <header class="bg-blue-600 text-white shadow-lg">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-white rounded-lg flex items-center justify-center">
                        <span class="text-blue-600 font-bold text-lg">T1</span>
                    </div>
                    <span class="text-xl font-bold">Database Manager</span>
                </div>
                <div class="flex space-x-4">
                    <a href="dashboard.html" class="hover:text-blue-200 transition">Dashboard</a>
                    <a href="admin-management.html" class="hover:text-blue-200 transition">Admin</a>
                </div>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-4 py-8">
        <h1 class="text-3xl font-bold text-gray-800 mb-8">Database Tables</h1>

        <!-- Clients Table -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-8">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-semibold text-gray-800">Clients & Sub-Clients</h2>
                <button onclick="addClientRow()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition">
                    <i class="fas fa-plus mr-2"></i>Add Row
                </button>
            </div>
            
            <div class="overflow-x-auto">
                <table class="w-full border-collapse border border-gray-300">
                    <thead>
                        <tr class="bg-gray-100">
                            <th class="border border-gray-300 px-4 py-2 text-left">ID</th>
                            <th class="border border-gray-300 px-4 py-2 text-left">Client</th>
                            <th class="border border-gray-300 px-4 py-2 text-left">Sub-Client</th>
                            <th class="border border-gray-300 px-4 py-2 text-left">Created At</th>
                            <th class="border border-gray-300 px-4 py-2 text-left">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="clientsTable">
                        <!-- Clients data will be loaded here -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Categories Table -->
        <div class="bg-white rounded-lg shadow-md p-6">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-semibold text-gray-800">Categories & Documents</h2>
                <button onclick="addCategoryRow()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition">
                    <i class="fas fa-plus mr-2"></i>Add Row
                </button>
            </div>
            
            <div class="overflow-x-auto">
                <table class="w-full border-collapse border border-gray-300">
                    <thead>
                        <tr class="bg-gray-100">
                            <th class="border border-gray-300 px-4 py-2 text-left">ID</th>
                            <th class="border border-gray-300 px-4 py-2 text-left">Category</th>
                            <th class="border border-gray-300 px-4 py-2 text-left">Document Type</th>
                            <th class="border border-gray-300 px-4 py-2 text-left">Created At</th>
                            <th class="border border-gray-300 px-4 py-2 text-left">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="categoriesTable">
                        <!-- Categories data will be loaded here -->
                    </tbody>
                </table>
            </div>
        </div>
    </main>

    <script>
        // Initialize Supabase
        const SUPABASE_URL = "https://webdmcvcbfeytwhzonem.supabase.co";
        const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndlYmRtY3ZjYmZleXR3aHpvbmVtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIzMDc5ODYsImV4cCI6MjA3Nzg4Mzk4Nn0.QlZeRqYvbdqNfRKrq_MIB0VBSM4ZcyeVtD_9O9uFAI8";
        
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        // Load all data
        async function loadAllData() {
            await loadClients();
            await loadCategories();
        }

        // Load clients data
        async function loadClients() {
            try {
                const { data, error } = await supabase
                    .from('sub_client')
                    .select('*')
                    .order('created_at', { ascending: false });

                if (error) throw error;

                const tbody = document.getElementById('clientsTable');
                tbody.innerHTML = data.map(client => `
                    <tr class="hover:bg-gray-50">
                        <td class="border border-gray-300 px-4 py-2">${client.id}</td>
                        <td class="border border-gray-300 px-4 py-2">
                            <input type="text" value="${client.clientList || ''}" 
                                   onchange="updateClient(${client.id}, 'clientList', this.value)"
                                   class="w-full p-1 border-none focus:ring-2 focus:ring-blue-500">
                        </td>
                        <td class="border border-gray-300 px-4 py-2">
                            <input type="text" value="${client.subClientList || ''}" 
                                   onchange="updateClient(${client.id}, 'subClientList', this.value)"
                                   class="w-full p-1 border-none focus:ring-2 focus:ring-blue-500">
                        </td>
                        <td class="border border-gray-300 px-4 py-2 text-sm">
                            ${new Date(client.created_at).toLocaleDateString()}
                        </td>
                        <td class="border border-gray-300 px-4 py-2">
                            <button onclick="deleteClient(${client.id})" class="text-red-600 hover:text-red-800 transition">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Error loading clients:', error);
                document.getElementById('clientsTable').innerHTML = `
                    <tr>
                        <td colspan="5" class="border border-gray-300 px-4 py-2 text-center text-red-600">
                            Error loading clients: ${error.message}
                        </td>
                    </tr>
                `;
            }
        }

        // Load categories data
        async function loadCategories() {
            try {
                const { data, error } = await supabase
                    .from('category')
                    .select('*')
                    .order('created_at', { ascending: false });

                if (error) throw error;

                const tbody = document.getElementById('categoriesTable');
                tbody.innerHTML = data.map(category => `
                    <tr class="hover:bg-gray-50">
                        <td class="border border-gray-300 px-4 py-2">${category.id}</td>
                        <td class="border border-gray-300 px-4 py-2">
                            <input type="text" value="${category.categoryList || ''}" 
                                   onchange="updateCategory(${category.id}, 'categoryList', this.value)"
                                   class="w-full p-1 border-none focus:ring-2 focus:ring-blue-500">
                        </td>
                        <td class="border border-gray-300 px-4 py-2">
                            <input type="text" value="${category.documents || ''}" 
                                   onchange="updateCategory(${category.id}, 'documents', this.value)"
                                   class="w-full p-1 border-none focus:ring-2 focus:ring-blue-500">
                        </td>
                        <td class="border border-gray-300 px-4 py-2 text-sm">
                            ${new Date(category.created_at).toLocaleDateString()}
                        </td>
                        <td class="border border-gray-300 px-4 py-2">
                            <button onclick="deleteCategory(${category.id})" class="text-red-600 hover:text-red-800 transition">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Error loading categories:', error);
                document.getElementById('categoriesTable').innerHTML = `
                    <tr>
                        <td colspan="5" class="border border-gray-300 px-4 py-2 text-center text-red-600">
                            Error loading categories: ${error.message}
                        </td>
                    </tr>
                `;
            }
        }

        // Add new client row
        async function addClientRow() {
            try {
                const { error } = await supabase
                    .from('sub_client')
                    .insert([{
                        clientList: 'New Client',
                        subClientList: 'New Sub-Client',
                        created_at: new Date().toISOString()
                    }]);

                if (error) throw error;
                
                await loadClients();
                alert('New client row added!');
            } catch (error) {
                console.error('Error adding client:', error);
                alert('Error adding client: ' + error.message);
            }
        }

        // Add new category row
        async function addCategoryRow() {
            try {
                const { error } = await supabase
                    .from('category')
                    .insert([{
                        categoryList: 'New Category',
                        documents: 'New Document Type',
                        created_at: new Date().toISOString()
                    }]);

                if (error) throw error;
                
                await loadCategories();
                alert('New category row added!');
            } catch (error) {
                console.error('Error adding category:', error);
                alert('Error adding category: ' + error.message);
            }
        }

        // Update client field
        async function updateClient(id, field, value) {
            try {
                const { error } = await supabase
                    .from('sub_client')
                    .update({ [field]: value })
                    .eq('id', id);

                if (error) throw error;
                
                console.log(`Updated client ${id} - ${field}: ${value}`);
            } catch (error) {
                console.error('Error updating client:', error);
                alert('Error updating client: ' + error.message);
                await loadClients(); // Reload to show correct values
            }
        }

        // Update category field
        async function updateCategory(id, field, value) {
            try {
                const { error } = await supabase
                    .from('category')
                    .update({ [field]: value })
                    .eq('id', id);

                if (error) throw error;
                
                console.log(`Updated category ${id} - ${field}: ${value}`);
            } catch (error) {
                console.error('Error updating category:', error);
                alert('Error updating category: ' + error.message);
                await loadCategories(); // Reload to show correct values
            }
        }

        // Delete client
        async function deleteClient(id) {
            if (!confirm('Are you sure you want to delete this client?')) return;

            try {
                const { error } = await supabase
                    .from('sub_client')
                    .delete()
                    .eq('id', id);

                if (error) throw error;
                
                await loadClients();
                alert('Client deleted successfully!');
            } catch (error) {
                console.error('Error deleting client:', error);
                alert('Error deleting client: ' + error.message);
            }
        }

        // Delete category
        async function deleteCategory(id) {
            if (!confirm('Are you sure you want to delete this category?')) return;

            try {
                const { error } = await supabase
                    .from('category')
                    .delete()
                    .eq('id', id);

                if (error) throw error;
                
                await loadCategories();
                alert('Category deleted successfully!');
            } catch (error) {
                console.error('Error deleting category:', error);
                alert('Error deleting category: ' + error.message);
            }
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Database manager loaded');
            loadAllData();
        });
    </script>
</body>
</html>
